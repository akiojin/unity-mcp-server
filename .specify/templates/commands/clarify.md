---
description: 現在の spec.md の曖昧点を最大5問の高優先度質問で解消し、回答をspecへ反映します。
handoffs:
  - label: 実装計画へ進む
    agent: speckit.plan
    prompt: 明確化済みspecに基づいてplanを作成してください。技術スタックは…
scripts:
  sh: .specify/scripts/bash/check-prerequisites.sh --json --paths-only
  ps: .specify/scripts/powershell/check-prerequisites.ps1 -Json -PathsOnly
---

## ユーザー入力

```text
$ARGUMENTS
```

空でない場合、続行する前にユーザー入力を考慮する**必要があります**。

## 目的

仕様の曖昧点や未決定事項を解消し、計画フェーズへの準備を整える。

## 実行手順

### 1. コンテキスト初期化

`{SCRIPT}` を**1回だけ**実行し、`FEATURE_SPEC`（spec.mdの絶対パス）と `FEATURE_DIR` を取得。

### 2. 仕様分析

spec.md を読み込み、以下を抽出:

**曖昧さ検出対象**:
- `[要明確化]` マーカー
- 曖昧な形容詞（高速、スケーラブル、セキュア、直感的）
- 未解決のプレースホルダー
- 測定可能な基準のない要件
- 矛盾する要件
- 未定義の用語

**優先度付け基準**:
1. スコープに影響する項目
2. セキュリティ/プライバシーに影響する項目
3. ユーザー体験に影響する項目
4. 技術的詳細

### 3. 質問生成と提示

最大5問に絞り、以下の形式で提示:

```markdown
## 質問 [N]: [トピック]

**コンテキスト**: [仕様からの引用]

**明確化が必要**: [具体的な質問]

**選択肢**:

| オプション | 回答 | 影響 |
|-----------|------|------|
| A | [1つ目の回答] | [機能への影響] |
| B | [2つ目の回答] | [機能への影響] |
| C | [3つ目の回答] | [機能への影響] |
| カスタム | 独自の回答 | [カスタム入力の説明] |

**選択**: _[ユーザーの回答を待機]_
```

### 4. 回答反映

回答を得たら spec.md に反映:

1. **明確化セクション追加/更新**:
   ```markdown
   ## 明確化

   ### セッション YYYY-MM-DD

   **Q1**: [質問]
   **A1**: [回答]
   ```

2. **関連セクション更新**:
   - 要件セクション
   - ユーザーストーリー
   - 成功基準
   - エッジケース
   - 前提条件

3. **[要明確化]マーカー削除**: 回答を反映した箇所のマーカーを削除

### 5. 完了報告

- 質問数（≤5）
- 更新した spec.md のパス
- 残っている曖昧点（あれば）
- 次ステップ `/speckit.plan`

## ガイドライン

- 1回のセッションで最大5問まで
- 各質問は具体的で、選択肢を提示
- 回答はspec.mdに直接反映
- 新しい曖昧点が見つかった場合は再度 `/speckit.clarify` を推奨
