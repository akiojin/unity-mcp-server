# 機能仕様書: ポート競合時の次アクション提示ログ

**機能ID**: `SPEC-8f4a2d0c`  
**作成日**: 2025-12-12  
**ステータス**: 下書き  
**入力**: SPEC-7f0d2aa1 の補完（リトライ後も復旧しない場合のUX）

## 背景

`StartTcpListener()` がリトライ上限に達してもポート競合が解消しない場合、現状は「ポートが使用中」というエラーログのみで、ユーザーが次に何をすべきか分かりづらい。手動復旧に必要な情報（設定場所/候補ポート）がログに不足している。

## 目的

- 競合が恒常的な場合でも、ユーザーが**迷わず復旧行動を取れるログ**を提示する。

## ユーザーシナリオ＆テスト *(必須)*

### ユーザーストーリー1 - 競合が解消しない時に具体的な復旧手順を知りたい (優先度: P2)
最大リトライ後に失敗したとき、ログに候補ポートと設定場所が出ていればすぐ直せる。

**独立テスト**: 候補ポート生成が期待通り（連番/上限/除外）であれば価値成立。

**受け入れシナリオ**:
1. **前提** 6400 が競合しリトライ上限に到達、**結果** ログに `Suggested ports: 6401, 6402, 6403` と `.unity/config.json unity.port` 更新手順が出る。

## 要件 *(必須)*

### 機能要件
- **FR-001**: 最大リトライ超過時に、候補ポート（現ポート+1..+3）をログに提示する。
- **FR-002**: 利用している設定ファイルパスが判明している場合、ログに含める。
- **FR-003**: 具体的な復旧方法として、`unity.port` を `.unity/config.json` か `UNITY_PORT` 環境変数で変更→Unity再起動を案内する。

### 非機能要件
- **NFR-001**: ログは1〜2行で簡潔にし、スパム化しない。

## スコープ外

- 自動で別ポートに切り替える機能。
