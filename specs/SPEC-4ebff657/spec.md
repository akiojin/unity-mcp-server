# 機能仕様書: Unity メニュー起動とサンプルワークフロー

**機能ID**: `SPEC-4ebff657`
**作成日**: 2025-12-04
**ステータス**: 下書き
**入力**: ユーザー説明: "Unity メニューで Start/Stop とサンプルワークフロー実行"

## ユーザーシナリオ＆テスト *(必須)*

### ユーザーストーリー1 - 非開発者でもサーバーを起動・停止したい (優先度: P1)
アート/QA がターミナルなしで Unity メニューから MCP サーバーを Start/Stop でき、現在のチャネル/ポートが UI で確認できるようにしたい。

**この優先度の理由**: 導入障壁を下げ、非開発者でも自走できることが採用の鍵。

**独立テスト**: メニュー Start→ヘルスチェック成功、Stop→プロセス終了をエディタテストで確認すれば価値成立。

**受け入れシナリオ**:
1. **前提** Unity プロジェクトが開いている、**実行** `MCP Server → Start`、**結果** 起動しステータス/ポートが UI に表示。
2. **前提** 稼働中、**実行** `MCP Server → Stop`、**結果** プロセス停止と UI 更新。

---

### ユーザーストーリー2 - すぐ試せるサンプルを実行したい (優先度: P2)
導入直後に「動く例」をワンクリックで体験したい。シーン操作と Addressables 登録のサンプルを実行し、結果がログで確認できること。

**この優先度の理由**: 価値を短時間で示し、チーム合意を得やすくするため。

**独立テスト**: サンプル実行後にデモオブジェクト生成と Addressables 一時登録がログに出れば価値成立。

**受け入れシナリオ**:
1. **前提** サーバー稼働中、**実行** `Run Sample (Scene)`、**結果** デモオブジェクト生成とログ出力。
2. **前提** Addressables 有効、**実行** `Run Sample (Addressables)`、**結果** 一時グループ登録とログ出力。

---

### ユーザーストーリー3 - GUI から設定を切替えたい (優先度: P3)
HTTP/stdio 切替やテレメトリ on/off を GUI で変更し、その設定で起動できるようにしたい。

**独立テスト**: GUI で HTTP ON にして Start、ヘルスチェック成功とポート表示を確認すれば価値成立。

**受け入れシナリオ**:
1. **前提** サーバー停止中、**実行** GUI で HTTP を有効化し Start、**結果** HTTP ポートが UI/ログに表示。
2. **前提** テレメトリ禁止環境、**実行** GUI で Telemetry Off を選択し Start、**結果** 起動ログに「テレメトリ送信なし」が表示。

### エッジケース
- 稼働中に Start を押した場合は重複起動せずステータスを表示。
- Stop 実行時にプロセスが見つからなくても UI をエラーで落とさず再起動ガイドを出す。
- サンプル実行は一時オブジェクト/グループを使い、後処理でクリーンアップする。

## 要件 *(必須)*

### 機能要件
- **FR-001**: Unity メニュー/EditorWindow に Start/Stop ボタンと現在の接続チャネル・ポート表示を提供する。
- **FR-002**: Start 実行後にヘルスチェック結果を UI に表示し、ポート番号を明記する。
- **FR-003**: Stop 実行でサーバープロセスを確実に終了し、UI を停止状態に更新する。
- **FR-004**: Scene サンプル実行でデモオブジェクト生成とログ出力を行い、クリーンアップ手順を提示する。
- **FR-005**: Addressables サンプル実行でテスト用アセットを一時グループに登録し、結果をログ表示する。
- **FR-006**: GUI から HTTP/stdio 切替とテレメトリ On/Off を設定し、Start 時に反映する。
- **FR-007**: すべてのメニュー操作は日本語/英語の人間可読メッセージを返す。

### 主要エンティティ
- **StartupSettings**: transport, httpPort, telemetryEnabled。
- **SampleWorkflow**: Scene/Addressables の実行定義と結果。

## スコープ外
- GUI ログビューアや監視ダッシュボード。
- 自動ロールバックタイマー（手動クリーンアップのみ）。

## 技術制約
- Unity 2020.3 LTS 以降で動作。
- Play 中は Start/Stop を無効化または警告表示。

## 前提条件
- Addressables パッケージが有効（サンプル実行時）。

## 依存関係
- HTTP/stdio/telemetry 設定 (SPEC-a28f3f95) の CLI オプション。

## 成功基準
1. QA メンバーがメニュー操作だけで Start/Stop を 3 回連続成功（ヘルスチェック 200）。
2. Scene/Addressables サンプルが 1 回の操作で成功し、後処理が実行される。
3. GUI で切替えた transport/telemetry 設定が Start 時に正しく反映されることを 3 パターンで確認。
