# 機能仕様書: Unity Addressablesコマンドサポート

**機能ID**: `SPEC-a108b8a3`
**作成日**: 2025-11-07
**ステータス**: 下書き
**入力**: ユーザー説明: "Unity Addressablesの完全なMCPツールサポートを追加。アセットの動的登録、グループ整理、ビルド自動化、依存関係分析のすべてをLLMエージェントから操作可能にする。"

## ユーザーシナリオ＆テスト *(必須)*

### ユーザーストーリー1 - アセットのAddressables登録 (優先度: P1)

LLMエージェントが、Unityプロジェクト内のアセット（プレハブ、マテリアル、テクスチャ等）をAddressablesシステムに登録できる。エージェントは「このプレハブをAddressableとして登録して」と指示されると、該当アセットをAddressablesに追加し、アドレス名やラベルを設定できる。

**この優先度の理由**: Addressablesの最も基本的な機能であり、他のすべての機能の前提となる。この機能だけでも、手動作業の自動化という価値を提供できる。

**独立テスト**: 「特定のアセットパスを指定してAddressable登録を実行」することで完全にテストでき、「アセット管理の自動化」という価値を提供する。

**受け入れシナリオ**:

1. **前提** Unityプロジェクトに未登録のプレハブが存在する、**実行** LLMエージェントがそのプレハブをAddressableとして登録する、**結果** プレハブがAddressablesシステムに登録され、指定されたアドレス名でアクセス可能になる
2. **前提** Addressableとして登録済みのアセットが存在する、**実行** LLMエージェントがそのアセットのアドレス名を変更する、**結果** アセットのアドレス名が更新され、新しい名前でアクセス可能になる
3. **前提** Addressableとして登録済みのアセットが存在する、**実行** LLMエージェントがそのアセットにラベルを追加する、**結果** アセットに指定されたラベルが付与され、ラベル検索で見つけられるようになる
4. **前提** Addressableとして登録済みのアセットが存在する、**実行** LLMエージェントがそのアセットをAddressablesから削除する、**結果** アセットがAddressablesシステムから削除され、通常のアセットとして扱われる
5. **前提** プロジェクトにAddressableアセットが複数存在する、**実行** LLMエージェントが登録済みアセット一覧を取得する、**結果** すべての登録済みアセットの情報（パス、アドレス名、ラベル、所属グループ）が返される

---

### ユーザーストーリー2 - グループ管理と整理 (優先度: P2)

LLMエージェントが、Addressablesグループを作成・削除し、アセットを適切なグループに整理できる。エージェントは「UI関連のアセットを『UIGroup』にまとめて」と指示されると、新規グループを作成し、該当アセットを移動できる。

**この優先度の理由**: 複数のアセットを管理する際に不可欠な機能。グループ単位での操作により、大規模プロジェクトでの管理効率が向上する。

**独立テスト**: 「グループ作成とアセット移動の一連の操作」を実行することで完全にテストでき、「アセット整理の効率化」という価値を提供する。

**受け入れシナリオ**:

1. **前提** Unityプロジェクトが存在する、**実行** LLMエージェントが新しいAddressablesグループを作成する、**結果** 指定された名前のグループが作成され、グループ一覧に表示される
2. **前提** 複数のAddressablesグループが存在する、**実行** LLMエージェントがグループ一覧を取得する、**結果** すべてのグループ名とその設定情報が返される
3. **前提** Addressableアセットとグループが存在する、**実行** LLMエージェントがアセットを別のグループに移動する、**結果** アセットの所属グループが変更され、新しいグループ内に表示される
4. **前提** 空のAddressablesグループが存在する、**実行** LLMエージェントがそのグループを削除する、**結果** グループが削除され、グループ一覧から消える

---

### ユーザーストーリー3 - ビルドの自動実行 (優先度: P3)

LLMエージェントが、Addressablesのビルドを実行できる。エージェントは「Addressablesをビルドして」と指示されると、すべてのAddressableアセットをパッケージ化し、ビルド結果を報告できる。

**この優先度の理由**: 開発ワークフローの自動化に貢献する。手動でのビルド操作が不要になり、CI/CD統合の基盤となる。

**独立テスト**: 「ビルドコマンドを実行し、ビルド結果を確認」することで完全にテストでき、「ビルド作業の自動化」という価値を提供する。

**受け入れシナリオ**:

1. **前提** Addressableアセットが登録されている、**実行** LLMエージェントがAddressablesビルドを実行する、**結果** すべてのAddressableアセットがビルドされ、ビルド成功が報告される
2. **前提** Addressablesのビルドキャッシュが存在する、**実行** LLMエージェントがビルドキャッシュをクリアする、**結果** キャッシュが削除され、次回ビルドがクリーンビルドになる
3. **前提** Addressablesビルドが失敗する可能性がある状態、**実行** LLMエージェントがビルドを実行する、**結果** エラー内容が詳細に報告され、問題箇所が特定できる

---

### ユーザーストーリー4 - 依存関係の分析 (優先度: P4)

LLMエージェントが、Addressablesの依存関係を分析し、重複アセットや未使用アセットを検出できる。エージェントは「重複しているアセットを見つけて」と指示されると、複数のグループに含まれている同じアセットを特定し、最適化の提案ができる。

**この優先度の理由**: プロジェクトの最適化に役立つが、基本機能が動作していれば後から追加可能。パフォーマンス改善やファイルサイズ削減に貢献する。

**独立テスト**: 「分析コマンドを実行し、検出された問題を確認」することで完全にテストでき、「アセット最適化の支援」という価値を提供する。

**受け入れシナリオ**:

1. **前提** 複数のグループに同じアセットが含まれている、**実行** LLMエージェントが依存関係分析を実行する、**結果** 重複アセットがリストアップされ、影響範囲が報告される
2. **前提** Addressableアセット間に依存関係が存在する、**実行** LLMエージェントが特定アセットの依存関係を解析する、**結果** そのアセットが依存している他のアセット一覧が返される
3. **前提** どのAddressableエントリからも参照されていないアセットが存在する、**実行** LLMエージェントが未使用アセットを検出する、**結果** 未使用アセットがリストアップされ、削除候補として提示される

---

### エッジケース

- **存在しないアセットパスを指定した場合**: エラーメッセージで「指定されたパスのアセットが見つかりません」と明確に通知される
- **既に登録済みのアセットを再度登録しようとした場合**: 既存エントリの情報が返され、重複登録は行われない（または、上書き確認のメッセージが表示される）
- **使用中のグループを削除しようとした場合**: エラーメッセージで「グループ内にアセットが存在するため削除できません」と通知される
- **ビルド中に別のビルドを開始しようとした場合**: 「ビルドが既に実行中です」とエラーが返される
- **Addressablesパッケージがインストールされていない場合**: 「Addressablesパッケージがインストールされていません」と明確なエラーが返される
- **アセットのアドレス名が重複した場合**: 警告が表示され、一意な名前を提案する

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは、LLMエージェントがUnityプロジェクト内の任意のアセットをAddressablesシステムに登録できる必要がある
- **FR-002**: システムは、登録済みアセットのアドレス名を変更できる必要がある
- **FR-003**: システムは、アセットにラベルを追加・削除できる必要がある
- **FR-004**: システムは、Addressableアセットを登録解除できる必要がある
- **FR-005**: システムは、登録済みAddressableアセットの一覧を取得できる必要がある
- **FR-006**: システムは、Addressablesグループを作成・削除できる必要がある
- **FR-007**: システムは、アセットを別のグループに移動できる必要がある
- **FR-008**: システムは、すべてのAddressablesグループの一覧を取得できる必要がある
- **FR-009**: システムは、Addressablesのビルドを実行できる必要がある
- **FR-010**: システムは、Addressablesビルドのキャッシュをクリアできる必要がある
- **FR-011**: システムは、Addressablesの依存関係を分析できる必要がある
- **FR-012**: システムは、重複アセットを検出できる必要がある
- **FR-013**: システムは、未使用アセットを検出できる必要がある
- **FR-014**: システムは、すべての操作結果をLLMエージェントが理解しやすい形式で返す必要がある
- **FR-015**: システムは、エラーが発生した場合に詳細なエラー情報を返す必要がある

### 主要エンティティ

- **AddressableEntry**: Addressablesに登録されたアセット。アセットパス、アドレス名、ラベル、所属グループの情報を持つ
- **AddressablesGroup**: アセットをまとめる論理的なグループ。グループ名、ビルド設定、含まれるエントリの情報を持つ
- **BuildResult**: Addressablesビルドの実行結果。成功/失敗ステータス、ビルド時間、エラー情報を持つ
- **AnalysisReport**: 依存関係分析の結果。重複アセット、未使用アセット、依存関係グラフの情報を持つ

---

## スコープ外 *(オプション)*

以下の機能は本仕様のスコープ外とし、将来のバージョンで対応予定:

- Addressablesの高度なビルド設定（圧縮方式、プラットフォーム別設定等）のカスタマイズ
- リモートカタログの設定と管理
- Addressablesプロファイルの作成と切り替え
- Content Update Workflowの自動化
- Addressablesのランタイムロード/アンロード操作（これはエディタツールではなくランタイム機能のため）

---

## 技術制約 *(該当する場合)*

- Unity Addressablesパッケージ（com.unity.addressables）がプロジェクトにインストールされている必要がある
- Unity Editorが起動している状態でのみ操作可能（PlayMode中は一部操作が制限される可能性がある）
- Addressablesのビルドは、プロジェクトサイズに応じて数秒から数分かかる場合がある

---

## 前提条件 *(該当する場合)*

この機能は以下を前提とします:

- Unity Addressablesパッケージがプロジェクトに正しくインストールされている
- AddressableAssetSettingsが初期化されている（初回使用時に自動生成される）
- 既存のMCPサーバーとUnity Editor間の通信機能が正常に動作している

---

## 依存関係 *(該当する場合)*

この機能は以下に依存します:

- Unity MCP Serverサーバー（既存）
- Unity Editorとの双方向通信機能（既存）
- Unity Addressablesパッケージ（com.unity.addressables）

---

## 成功基準 *(必須)*

以下の成功基準を満たす必要があります:

1. LLMエージェントが、5秒以内にアセットのAddressables登録を完了できる
2. LLMエージェントが、100個のアセットを含むグループ一覧を3秒以内に取得できる
3. LLMエージェントが、すべてのAddressables操作を自然言語の指示で実行でき、手動操作が不要になる
4. 依存関係分析が、1000個のアセットを含むプロジェクトで30秒以内に完了する
5. すべてのエラー状況で、エージェントが問題を理解し対処できる詳細なエラーメッセージが返される

---

## ⚡ クイックガイドライン

- ✅ ユーザーが「何を」必要とし「なぜ」必要なのかに焦点を当てる
- ❌ 「どのように」実装するかを避ける (技術スタック、API、コード構造なし)
- 👥 ビジネス関係者向けに記述 (開発者向けではない)
