---
description: 自然言語の要件説明から、機能仕様（spec.md）を作成または更新します（ブランチ作成なし）。
handoffs:
  - label: 実装計画を作成
    agent: speckit.plan
    prompt: plan.md を作成してください。技術スタックは…
  - label: 仕様の曖昧点を解消
    agent: speckit.clarify
    prompt: 仕様の曖昧点を明確化してください
    send: true
scripts:
  sh: .specify/scripts/bash/create-new-feature.sh --json "{ARGS}"
  ps: .specify/scripts/powershell/create-new-feature.ps1 -Json "{ARGS}"
---

## ユーザー入力

```text
$ARGUMENTS
```

空でない場合、続行する前にユーザー入力を考慮する**必要があります**。

## 概要

`/speckit.specify` の後にユーザーが入力したテキストが要件説明です。`{ARGS}` が空でない限り、それを要件説明として使用します。

## 実行手順

1. **スクリプト実行**: `{SCRIPT}` をリポジトリルートから実行し、JSON出力から `FEATURE_ID` / `FEATURE_DIR` / `SPEC_FILE` を取得します（パスはすべて絶対パス）。
   - シングルクォートを含む引数（例: "I'm Groot"）は `'I'\''m Groot'` のようにエスケープ

2. **テンプレート読み込み**: `.specify/templates/spec-template.md` を読み、必須セクションと見出し構造を理解します。

3. **仕様書作成**: `SPEC_FILE` をテンプレート構造に沿って埋めます:

   **実行フロー**:
   1. ユーザー入力を解析 → 空の場合はエラー
   2. キーコンセプトを抽出（アクター、アクション、データ、制約）
   3. 不明な点は:
      - 文脈や業界標準から推測
      - `[要明確化: 具体的な質問]` は以下の場合のみ:
        - 機能スコープやUXに大きく影響
        - 複数の解釈が可能
        - 合理的なデフォルトがない
      - **最大3つまで**（スコープ > セキュリティ > UX > 技術詳細の優先順位）
   4. ユーザーシナリオとテストセクションを埋める
   5. 機能要件を生成（各要件はテスト可能であること）
   6. 成功基準を定義（測定可能、技術非依存）
   7. キーエンティティを特定（データが関係する場合）

   **ガイドライン**:
   - 「何を」「なぜ」を中心に書く（実装方法・技術スタック・API・コード構造は書かない）
   - ユーザーストーリーは優先度順（P1→P2→P3）で、**独立してテスト可能**にする
   - ビジネスステークホルダー向けに書く（開発者向けではない）

4. **仕様品質チェックリスト**: `FEATURE_DIR/checklists/requirements.md` に作成:

   ```markdown
   # 仕様品質チェックリスト: [機能名]

   **目的**: 計画フェーズに進む前に仕様の完全性と品質を検証
   **作成日**: [日付]
   **対象**: [spec.mdへのリンク]

   ## コンテンツ品質

   - [ ] 実装詳細（言語、フレームワーク、API）が含まれていない
   - [ ] ユーザー価値とビジネスニーズに焦点を当てている
   - [ ] 非技術者向けに書かれている
   - [ ] 必須セクションがすべて完了している

   ## 要件の完全性

   - [ ] [要明確化]マーカーが残っていない
   - [ ] 要件がテスト可能で曖昧でない
   - [ ] 成功基準が測定可能
   - [ ] 成功基準が技術非依存
   - [ ] すべての受け入れシナリオが定義されている
   - [ ] エッジケースが特定されている
   - [ ] スコープが明確に境界付けられている
   - [ ] 依存関係と前提条件が特定されている

   ## 機能準備状況

   - [ ] すべての機能要件に明確な受け入れ基準がある
   - [ ] ユーザーシナリオが主要フローをカバー
   - [ ] 仕様に実装詳細が漏れていない
   ```

5. **品質検証**: チェックリストに照らして仕様を検証:
   - **すべて合格**: ステップ6へ
   - **失敗項目あり**: 仕様を更新して再検証（最大3回）
   - **[要明確化]が残っている場合**: ユーザーに選択肢を提示（最大3つ）

6. **完了報告**:
   - `FEATURE_ID` と `SPEC_FILE`
   - `specs/specs.md`（要件一覧）が更新されている旨
   - 次ステップ `/speckit.clarify` または `/speckit.plan`

## 成功基準ガイドライン

成功基準は以下を満たすこと:

1. **測定可能**: 具体的なメトリクス（時間、パーセンテージ、件数、レート）
2. **技術非依存**: フレームワーク、言語、データベース、ツールに言及しない
3. **ユーザー中心**: システム内部ではなく、ユーザー/ビジネス視点の結果
4. **検証可能**: 実装詳細を知らなくてもテスト/検証可能

**良い例**:
- 「ユーザーは3分以内にチェックアウトを完了できる」
- 「システムは10,000同時ユーザーをサポート」
- 「95%の検索が1秒以内に結果を返す」

**悪い例**（実装に依存）:
- 「APIレスポンスタイムが200ms以下」
- 「データベースが1000 TPSを処理可能」
- 「Reactコンポーネントが効率的にレンダリング」

## 注意

- 要件IDは `specs/SPEC-xxxxxxxx/` で管理します（Speckitはブランチを作成しません）。
- 合理的なデフォルトを使用し、不要な質問は避ける:
  - データ保持: 業界標準
  - パフォーマンス: 標準的なWebアプリの期待値
  - エラーハンドリング: ユーザーフレンドリーなメッセージ
  - 認証方式: セッションベースまたはOAuth2
